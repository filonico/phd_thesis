% document style
\documentclass[12pt]{report}
\usepackage[a4paper,
  % total={17cm,24cm},
  left=2cm, right=2cm, top=2cm, bottom=2cm]{geometry}
\linespread{1.5}                                    % regulate line spacing
\usepackage{setspace}
\usepackage[indent=20pt]{parskip}                   % indent first line
\usepackage[utf8]{inputenc}

% packages to print complete titles on table of contents
\usepackage{titletoc}
\titlecontents{chapter}
   [0pt]% <left>
   {\bfseries}% <above-code>
   {\chaptername\ \thecontentslabel: }% <numbered-entry-format>
   {}% <numberless-entry-format>
   {\titlerule*[0.8pc]{.}\contentspage}

% package to manage headers
\usepackage{fancyhdr}

% packages to manage tables
\usepackage{booktabs}
\usepackage{lscape}
\usepackage{longtable}
\usepackage{multirow}

% packages to manage images
\usepackage{graphicx}
\graphicspath{{./figures/}}

% typeset float content (table content) to sans-serif
\usepackage[font=sf]{floatrow}

% packages to manage bibliography and hyperref
\usepackage{nameref}
\usepackage[hidelinks]{hyperref}
\usepackage[style=apa, sorting=ynt, uniquename=false]{biblatex}
\newcommand{\citebold}[1]{\textbf{\cite{#1}}} % declare new command to make citations bold
\newcommand{\citeboldyearparent}[1]{\textbf{\citeauthor*{#1} (\citeyear{#1})}} % declare new command to make citations Author, et al . (year)
\addbibresource{tot.bib}

% package to manage random text
\usepackage{lipsum}

% packages for chemical formulae and special symbols
\usepackage{mhchem}
\usepackage{textcomp}
\usepackage{siunitx}
\sisetup{output-exponent-marker=\ensuremath{\mathrm{e}}} %correctly prints scientific notation

% packages and commands for acronyms (and species abbreviations)
\usepackage[acronym, nonumberlist, toc, nomain, nopostdot, shortcuts]{glossaries-extra}
\setabbreviationstyle[species]{long-only-short-only}
\setabbreviationstyle[gene]{long-em-short-em}
\loadglsentries{sections/abbreviations}	
\renewcommand{\glsnamefont}[1]{\textbf{#1}} % make entries in glossary bold
\newcommand*{\pac}[2][]{\ifglsused{#2}{\acs[#1]{#2}}{%
 \glsunset{#2}%
 \acl[#1]{#2} [\acs[#1]{#2}]}}
\preto\chapter\glsresetall % reset glossary for every chapter

% packages to manage captions and cross-referencing
\usepackage[labelfont=bf, labelsep=endash, font={small,sf,onehalfspacing}]{caption}
\usepackage{subcaption}
\DeclareCaptionLabelFormat{nocaption}{}                                                                         % new empty caption label format (useful to include and reference subfigures)
\DeclareCaptionFormat{hruleformat}{#1#2#3\hrulefill}                                                            % add hrule after caption
\renewcommand{\thesubfigure}{\Alph{subfigure}}                                                                  % capitalize counters for subfigures
\usepackage[capitalise]{cleveref}                                                                               % capitalize the first letter of \cref abbreviation
\crefdefaultlabelformat{\textbf{#2#1#3}}                                                                        % cref default format (for single reference)
\crefname{section}{\textbf{Section}}{\textbf{Sections}}                                                         % cref format for section {type}{single}{plurale}
\crefname{figure}{\textbf{Fig.}}{\textbf{Fig.}}                                                                 % cref format for figures
\crefname{table}{\textbf{Tab.}}{\textbf{Tab.}}                                                                  % cref format for tables
\crefrangeformat{figure}{\textbf{Fig.~#3#1#4--#5#2#6}}                                                          % cref format for ranged figures
\crefrangeformat{table}{\textbf{Tab.~#3#1#4--#5#2#6}}                                                           % cref format for ranged figures
\crefmultiformat{figure}{\textbf{Fig.~#2#1#3}}{ and \textbf{#2#1#3}}{, \textbf{#2#1#3}}{, \textbf{and #2#1#3}}  % cref format for multi-ref figures
\crefmultiformat{table}{\textbf{Tab.~#2#1#3}}{ and \textbf{#2#1#3}}{, \textbf{#2#1#3}}{, \textbf{and #2#1#3}}   % cref format for multi-ref tables
\newcommand\crefpairgroupconjunction{; }                                                                        % cref format for among-group reference
\newcommand\crefmiddlegroupconjunction{; }                                                                      % cref format for among-group reference
\newcommand\creflastgroupconjunction{; }                                                                        % cref format for among-group reference

% i don't know what the following code is doing, but it deals with incompatibility of longtable and cleveref
% from https://tex.stackexchange.com/questions/722905/cleveref-not-working-for-label-after-caption-in-longtable (21/20/2024)
\makeatletter
\newcommand\cref@smugglelabel{\let\cref@currentlabel\cref@gcurrentlabel@temp}
\newcommand\cref@updatelabeldata[1]{%
 \cref@constructprefix{#1}{\cref@result}%
  \@ifundefined{cref@#1@alias}%
    {\def\@tempa{#1}}%
    {\def\@tempa{\csname cref@#1@alias\endcsname}}%
  \protected@xdef\cref@gcurrentlabel@temp{%
    [\@tempa][\arabic{#1}][\cref@result]%
    \csname p@#1\endcsname\csname the#1\endcsname}%
  \aftergroup\cref@smugglelabel  
    }
% test if \@currentcounter is empty for unnumbered sections 
\AddToHook{label}{\ifx\@currentcounter\@empty\else\cref@updatelabeldata{\@currentcounter}\fi} 
 
\makeatother

%-------------------------------------------------------------------------

\begin{document}

\include{sections/frontpage.tex}

\newgeometry{a4paper,
  % total={17cm,24cm},
  left=2cm, right=2cm, top=2.5cm, bottom=2.5cm,
  headsep=\dimexpr2.5cm-50pt\relax,
  headheight=50pt}

% set page headers
\pagestyle{fancy} % page style to fancy to print header
\renewcommand{\headrulewidth}{0.2pt} % remove head ruler
\renewcommand{\chaptermark}[1]{\markboth{\chaptername\ \thechapter}{}} % set leftmark style of chapters
\fancyhead{} % clear header
\fancyhead[RO]{\textsl{\nouppercase{\leftmark}}} % set header

\pagenumbering{roman}
\renewcommand{\contentsname}{\vspace{-3.5cm}Table of contents}
\tableofcontents{\markboth{Table of contents}{Table of contents}}
\addcontentsline{toc}{chapter}{Table of contents} % include the TOC in TOC
\clearpage

\pagenumbering{arabic}

\printunsrtglossary*[title={\vspace{-3.5cm}List of abbreviations}, toctitle={List of abbreviations}, style={super}]
{
	\small
	\renewcommand{\printunsrtglossaryentryprocesshook}[1]{%
		\glsxtriflabelinlist
		{\glscategory{#1}} % category label for this entry
		{species} % exclusion list
		{\printunsrtglossaryskipentry} % skip (exclude)
		{} % don't skip (include)
	}
}

% \listoffigures
% \addcontentsline{toc}{chapter}{List of figures}
% \listoftables
% \addcontentsline{toc}{chapter}{List of tables}


\begingroup
\captionsetup[figure]{format=hruleformat}
\include{sections/chapter1_introduction}
\include{sections/chapter2_perspective}
\include{sections/chapter3_molecularEvolution}
\include{sections/chapter4_insitu}
\endgroup

% bibliography
\begin{refcontext}[sorting=nyt]
	\printbibliography[title=References]
	\addcontentsline{toc}{chapter}{References}
\end{refcontext}

% appendix and supp matherials
\include{sections/appendix}
\include{sections/supp_materials}
\include{sections/data_availability}

% activity report
\include{sections/activity_report}

\end{document}
